"If you want total security, go to prison. There you're fed, clothed, given medical care and so on. The only
thing lacking ... is freedom."

-- Dwight D. Eisenhower 


- Low-hanging fruit is easier to pick
- Eliminating the most obvious riskes can make a big difference to security 

Attack Surface
--------------
"The attack surface of a software environment is the sum of the different points (the "attack vectors") where
an unauthorized user can try to enter data to or extract data from an environment."
(Wiki)

* Taking control of your servers
* Assessing vulnerability 
* Implementing a security policy with PAM
* Taming the root account
* Controlling access to services
* Looking for suspicious activity 

Looking at log files
Recovering from a lost root password
- Rescure boot
- Forced single-user boot
Setting a boot loader password 
Configuring key-based ssh login 


$ cat /var/log/secure 

$ grep pam_succeed_if secure | less


Rescue Booting
--------------
Require physical machine

Boot from Installation Media in Rescue mode
==>
Linux running with In-memory filesystem 

Forced Single-User Boot
-----------------------
Asking GRUB to pass additional parameter we can tell not to run init or systemd. 

Press 'e' in bootloader menu. 
Go to line /vmlinuz
1. Change ro => rw
2. Add init=/sysroot/bin/sh 

Ctrl + x

# chroot /sysroot
# passwd root
# touch /.autorelabel

Restart the machine.

Setting a GRUB Password
-----------------------
Grub2 configuration file
# cd /etc/grub.d/
# ls
01_users

# vi 01_users

Add the following:
cat << EOF
set superuser="admin"
password admin admins-pass
EOF

# vi 10_linux

/CLASS
CLASS="--class ...--unrestricted"

Remove --unrestricted : Take out to force grub to request username and password.

# cd /boot/grub2
# cp grub.cfg grub.cfg.backup
# grub2-mkconfig -o /boot/grub2/grub.cfg
# reboot

Secure Shell
------------
telnet : not secure
rsh/rcp : not secure

ssh
Universally used for secure remote command-line access cryptographic handshake authenticates the server and securely 
exchanges encryption key.

Asymmetric Cryptography

SSH Host Keys
-------------
RSA host key pair generated when sshd installed 

Server 
-------
Private Key stored in /etc/ssh/ssh_host_key

Public Key Server Stored in /etc/ssh/ssh_host_key.pub

Client
------
Clients store the public keys of known hosts in:
/etc/ssh/ssh_known_hosts (System Wide)
Can be harvested from Servers using ssh-keygen.

And/or:
~/.ssh/known_hosts
(Per User)
Captured from server on user's first login

SSH User Keys
=============
RSA use key pair generated by running ssh-keygen.

Private Key 
Client 
Encrypted with pass phrase stroed in ~/.ssh/id_rsa.

Public Key
Client 
Stored in ~/.ssh/id_rsa.pub

Server
Manually copied to ~/.ssh/authorized_keys.
Use scp or ssh-copy-id

Setup Key Based SSH Auth
========================
Client
------
$ cat /etc/hosts
$ ssh centos7box hostname

$ ssh-keygen 
....
passphrase):
$ ls .ssh
known_hosts : public key of the servers.
$ ssh-copy-id <servername>

Server
======
$ ls .ssh
authorized_keys
==> Public key of clients recorded.

Client
======
$ ssh <servername>
=> Ask for passphrase.

Using ssh-agent to supply the pass phrase
ssh-agent holds pass phrases for ssh private keys on behalf of a user.
- Supplies tehm on demand
- Listens on a UNIX-domain socket
Add your keys with ssh-add

Client
======
$ ssh-add 
Enter Passphrase
$ ssh-add -l

$ ssh servername 
==> Without pass phrase

$ ssh servername mkdir docs
$ scp /etc/passwd servername:docs
$ ssh servername ls docs
$ alias c7='ssh servername'
$ c7 ls /home
$ c7



Assessing the Vulnerability of Linux Server
------------------------------------------

